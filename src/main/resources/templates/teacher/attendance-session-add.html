<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>创建签到 - 二维码签到系统</title>
  <!-- 引入公共样式CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
  <style>
    /* 全局通用样式 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* 侧边栏样式 - 固定布局 */
    .sidebar {
      min-height: 100vh;
      background: #2c3e50;
      color: white;
      position: fixed;
      top: 0;
      left: 0;
      width: 200px;
      z-index: 999;
      overflow-y: auto;
    }

    .sidebar .sidebar-header {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid #34495e;
    }

    .sidebar .user-info {
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid #34495e;
    }

    .sidebar .nav-link {
      color: #ecf0f1;
      padding: 12px 20px;
      display: block;
      text-decoration: none;
      border-left: 3px solid transparent;
      transition: all 0.3s ease;
    }

    .sidebar .nav-link:hover,
    .sidebar .nav-link.active {
      background: #34495e;
      border-left-color: #3498db;
    }

    .sidebar .nav-link i {
      margin-right: 8px;
    }

    /* 主内容区样式 */
    .main-content {
      margin-left: 200px;
      padding: 25px;
      background: #f8f9fa;
      min-height: 100vh;
    }

    /* 表单卡片样式 */
    .form-card {
      border: none;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      border-radius: 8px;
      max-width: 800px;
      margin: 0 auto;
    }

    /* 表单样式优化 */
    .form-label {
      font-weight: 500;
      color: #2c3e50;
    }

    .form-control:focus, .form-select:focus {
      border-color: #3498db;
      box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
    }

    /* 时间选择器样式 */
    input[type="datetime-local"] {
      font-size: 0.95rem;
    }

    /* 响应式适配 */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: relative;
        min-height: auto;
      }

      .main-content {
        margin-left: 0;
        padding: 15px;
      }

      .form-card {
        max-width: 100%;
      }

      .row > .col-md-6 {
        margin-bottom: 1rem;
      }
    }
  </style>
</head>
<body>
<!-- 侧边栏 -->
<div class="sidebar">
  <div class="sidebar-header">
    <h4><i class="bi bi-qr-code me-2"></i>签到系统</h4>
  </div>
  <div class="user-info">
    <i class="bi bi-person-circle fs-3 mb-2"></i>
    <h6>教师</h6>
    <p class="mb-1" th:text="${teacher.name}">张老师</p>
    <small th:text="${teacher.username}">teacher1</small>
  </div>
  <nav class="nav flex-column">
    <a th:href="@{/teacher/dashboard}" class="nav-link">
      <i class="bi bi-speedometer2"></i> 仪表板
    </a>
    <a th:href="@{/teacher/teaching-classes}" class="nav-link">
      <i class="bi bi-people"></i> 教学班管理
    </a>
    <a th:href="@{/teacher/attendance/sessions}" class="nav-link active">
      <i class="bi bi-check-circle"></i> 签到管理
    </a>
    <div class="mt-4">
      <a th:href="@{/logout}" class="nav-link text-danger">
        <i class="bi bi-box-arrow-right"></i> 退出登录
      </a>
    </div>
  </nav>
</div>

<!-- 主内容区 -->
<div class="main-content">
  <!-- 页面头部 -->
  <div class="mb-4">
    <h3><i class="bi bi-plus-circle text-success me-2"></i> 创建签到</h3>
    <a th:href="@{/teacher/attendance/sessions}" class="text-decoration-none text-muted">
      <i class="bi bi-arrow-left"></i> 返回签到列表
    </a>
  </div>

  <!-- 创建签到表单卡片 -->
  <div class="card form-card">
    <div class="card-body p-4">
      <form th:action="@{/teacher/attendance/sessions/add}" method="post" id="createSessionForm">
        <!-- 隐藏参数：教学班ID（如果从教学班页面跳转） -->
        <input type="hidden" name="classId" th:value="${classId}">

        <!-- 选择教学班 -->
        <div class="mb-3">
          <label for="teachingClassId" class="form-label">选择教学班 <span class="text-danger">*</span></label>
          <select class="form-select" id="teachingClassId" name="teachingClassId" required>
            <option value="">请选择教学班</option>
            <option th:each="tc : ${teachingClasses}"
                    th:value="${tc.id}"
                    th:text="${tc.className} + ' (' + tc.courseName + ')'"
                    th:selected="${tc.id == classId}">
              教学班名称 (课程名称)
            </option>
          </select>
        </div>

        <!-- 签到标题 -->
        <div class="mb-3">
          <label for="title" class="form-label">签到标题 <span class="text-danger">*</span></label>
          <input type="text" class="form-control" id="title" name="title"
                 placeholder="例如：第1次课签到、随堂签到、补签" required>
          <div class="form-text">请输入清晰的签到标题，便于学生识别</div>
        </div>

        <!-- 时间选择 -->
        <div class="row">
          <div class="col-md-6">
            <div class="mb-3">
              <label for="startTimeStr" class="form-label">开始时间 <span class="text-danger">*</span></label>
              <input type="datetime-local" class="form-control" id="startTimeStr" name="startTimeStr" required>
              <div class="form-text">签到开始的时间，建议设置为当前时间</div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="mb-3">
              <label for="endTimeStr" class="form-label">结束时间 <span class="text-danger">*</span></label>
              <input type="datetime-local" class="form-control" id="endTimeStr" name="endTimeStr" required>
              <div class="form-text">签到结束的时间，不可早于开始时间</div>
            </div>
          </div>
        </div>

        <!-- 签到描述 -->
        <div class="mb-4">
          <label for="description" class="form-label">签到描述（可选）</label>
          <textarea class="form-control" id="description" name="description" rows="3"
                    placeholder="例如：本次签到为第3章课程内容的随堂签到，迟到10分钟以上视为未签到..."></textarea>
        </div>

        <!-- 提交按钮 -->
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-save"></i> 创建并启动签到
          </button>
          <a th:href="@{/teacher/attendance/sessions}" class="btn btn-secondary">
            <i class="bi bi-x-circle"></i> 取消
          </a>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- 引入公共脚本CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // 初始化时间选择器：默认填充当前时间和1小时后时间
  document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    // 格式化当前时间为datetime-local格式（YYYY-MM-DDTHH:MM）
    const nowFormatted = now.toISOString().slice(0, 16);

    // 结束时间默认1小时后
    const endTime = new Date(now);
    endTime.setHours(endTime.getHours() + 1);
    const endTimeFormatted = endTime.toISOString().slice(0, 16);

    // 填充默认值（仅当输入框为空时）
    if (!document.getElementById('startTimeStr').value) {
      document.getElementById('startTimeStr').value = nowFormatted;
    }
    if (!document.getElementById('endTimeStr').value) {
      document.getElementById('endTimeStr').value = endTimeFormatted;
    }
  });

  // 表单验证：确保结束时间不早于开始时间
  document.getElementById('createSessionForm').addEventListener('submit', function(e) {
    const startTime = new Date(document.getElementById('startTimeStr').value);
    const endTime = new Date(document.getElementById('endTimeStr').value);
    const teachingClassId = document.getElementById('teachingClassId').value;
    const title = document.getElementById('title').value.trim();

    // 验证教学班选择
    if (!teachingClassId) {
      e.preventDefault();
      alert('请选择要创建签到的教学班！');
      document.getElementById('teachingClassId').focus();
      return;
    }

    // 验证标题
    if (title.length < 2) {
      e.preventDefault();
      alert('签到标题不能少于2个字符！');
      document.getElementById('title').focus();
      return;
    }

    // 验证时间
    if (endTime <= startTime) {
      e.preventDefault();
      alert('结束时间不能早于或等于开始时间！请重新选择');
      document.getElementById('endTimeStr').focus();
      // 高亮错误输入框
      document.getElementById('endTimeStr').classList.add('is-invalid');
      setTimeout(() => {
        document.getElementById('endTimeStr').classList.remove('is-invalid');
      }, 2000);
      return;
    }
  });

  // 实时验证时间选择
  document.getElementById('endTimeStr').addEventListener('change', function() {
    const startTime = new Date(document.getElementById('startTimeStr').value);
    const endTime = new Date(this.value);
    if (endTime <= startTime) {
      this.classList.add('is-invalid');
      alert('结束时间不能早于或等于开始时间！');
    } else {
      this.classList.remove('is-invalid');
    }
  });
</script>
</body>
</html>