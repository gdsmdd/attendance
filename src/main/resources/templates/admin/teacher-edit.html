<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>编辑教师 - 二维码签到系统</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: 100vh;
            background: #2c3e50;
            color: white;
        }
        .sidebar a {
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            display: block;
            border-left: 3px solid transparent;
        }
        .sidebar a:hover, .sidebar a.active {
            background: #34495e;
            border-left-color: #3498db;
        }
        .main-content {
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
        }
        .page-title {
            color: #2c3e50;
            border-bottom: 2px solid #ffc107;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .form-label {
            font-weight: 600;
            color: #495057;
        }
        .required::after {
            content: " *";
            color: #dc3545;
        }
        .teacher-info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .teacher-id {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .teacher-name {
            font-size: 1.8rem;
            font-weight: bold;
        }
        .status-badge {
            font-size: 0.9rem;
            padding: 5px 15px;
            border-radius: 20px;
        }
        .status-active {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }
        .status-inactive {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <!-- 侧边栏 -->
        <div class="col-md-2 p-0 sidebar">
            <div class="p-3">
                <h4 class="text-center mb-4">
                    <i class="fas fa-qrcode"></i> 签到系统
                </h4>
                <div class="user-info text-center mb-4">
                    <i class="fas fa-user-shield fa-2x mb-2"></i>
                    <h6>管理员</h6>
                    <p class="mb-1" th:text="${admin.name}">系统管理员</p>
                    <small th:text="${admin.username}">admin</small>
                </div>

                <nav class="nav flex-column">
                    <a th:href="@{/admin/dashboard}" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i> 仪表板
                    </a>
                    <a th:href="@{/admin/teachers}" class="nav-link active">
                        <i class="fas fa-chalkboard-teacher"></i> 教师管理
                    </a>
                    <a th:href="@{/admin/students}" class="nav-link">
                        <i class="fas fa-user-graduate"></i> 学生管理
                    </a>
                    <a th:href="@{/admin/departments}" class="nav-link">
                        <i class="fas fa-university"></i> 院系管理
                    </a>
                    <div class="mt-4">
                        <a th:href="@{/logout}" class="nav-link text-danger">
                            <i class="fas fa-sign-out-alt"></i> 退出登录
                        </a>
                    </div>
                </nav>
            </div>
        </div>

        <!-- 主内容区 -->
        <div class="col-md-10 main-content">
            <!-- 页面标题和操作按钮 -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="page-title">
                    <i class="fas fa-edit"></i> 编辑教师信息
                </h3>
                <div>
                    <a th:href="@{/admin/teachers}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left"></i> 返回列表
                    </a>
                </div>
            </div>

            <!-- 教师基本信息卡片 -->
            <div class="teacher-info-card">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="teacher-name" th:text="${teacher.name}">张三</div>
                        <div class="mt-2">
                            <span class="teacher-id" th:text="'工号：' + ${teacher.teacherId}">工号：T2023001</span>
                        </div>
                    </div>
                    <div class="col-md-6 text-end">
                        <div class="status-badge"
                             th:class="${teacher.status == 'ACTIVE'} ? 'status-active' : 'status-inactive'"
                             th:text="${teacher.status == 'ACTIVE'} ? '账号正常' : '账号停用'">
                            账号正常
                        </div>
                        <div class="mt-2">
                            <small>创建时间：<span th:text="${#temporals.format(teacher.createTime, 'yyyy-MM-dd')}">2023-01-01</span></small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 消息提示 -->
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-circle"></i>
                <span th:text="${error}">操作失败</span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- 编辑教师表单 -->
            <div class="card form-container">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-edit"></i> 编辑信息</h5>
                </div>
                <div class="card-body">
                    <form th:action="@{/admin/teachers/update}" method="post" id="teacherEditForm">
                        <input type="hidden" name="id" th:value="${teacher.id}">

                        <div class="row">
                            <!-- 基本信息 -->
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="teacherId" class="form-label required">教师工号</label>
                                    <input type="text" class="form-control" id="teacherId" name="teacherId"
                                           th:value="${teacher.teacherId}" required>
                                    <div class="form-text">工号将作为教师的唯一标识，不可重复</div>
                                </div>

                                <div class="mb-3">
                                    <label for="name" class="form-label required">姓名</label>
                                    <input type="text" class="form-control" id="name" name="name"
                                           th:value="${teacher.name}" required>
                                </div>

                                <div class="mb-3">
                                    <label for="username" class="form-label required">用户名</label>
                                    <input type="text" class="form-control" id="username" name="username"
                                           th:value="${teacher.username}" required>
                                    <div class="form-text">用户名用于登录系统，不可重复</div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="title" class="form-label">职称</label>
                                    <input type="text" class="form-control" id="title" name="title"
                                           th:value="${teacher.title}"
                                           placeholder="请输入职称（如：教授、副教授等）">
                                </div>

                                <div class="mb-3">
                                    <label for="departmentId" class="form-label required">所属院系</label>
                                    <select class="form-select" id="departmentId" name="departmentId" required>
                                        <option value="">请选择院系</option>
                                        <option th:each="dept : ${departments}"
                                                th:value="${dept.id}"
                                                th:text="${dept.name}"
                                                th:selected="${teacher.department.id == dept.id}">
                                            计算机学院
                                        </option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label required">账号状态</label>
                                    <div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="status"
                                                   id="statusActive" value="ACTIVE"
                                                   th:checked="${teacher.status == 'ACTIVE'}">
                                            <label class="form-check-label" for="statusActive">
                                                <i class="fas fa-check-circle text-success"></i> 启用
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input" type="radio" name="status"
                                                   id="statusInactive" value="INACTIVE"
                                                   th:checked="${teacher.status == 'INACTIVE'}">
                                            <label class="form-check-label" for="statusInactive">
                                                <i class="fas fa-times-circle text-danger"></i> 停用
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 备注信息 -->
                        <div class="row">
                            <div class="col-12">
                                <div class="mb-3">
                                    <label for="note" class="form-label">备注</label>
                                    <textarea class="form-control" id="note" name="note" rows="3"
                                              placeholder="可在此添加备注信息（选填）"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- 表单操作按钮 -->
                        <div class="row">
                            <div class="col-12">
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <a th:href="@{/admin/teachers/delete/{id}(id=${teacher.id})}"
                                           class="btn btn-danger"
                                           onclick="return confirm('确定要删除该教师吗？此操作不可恢复！')">
                                            <i class="fas fa-trash"></i> 删除教师
                                        </a>
                                    </div>
                                    <div>
                                        <button type="button" class="btn btn-outline-secondary" onclick="goBack()">
                                            取消
                                        </button>
                                        <button type="submit" class="btn btn-primary" id="submitBtn">
                                            <i class="fas fa-save"></i> 保存修改
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 操作历史 -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-history"></i> 最近操作</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                            <tr>
                                <th>时间</th>
                                <th>操作</th>
                                <th>说明</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td th:text="${#temporals.format(teacher.createTime, 'yyyy-MM-dd HH:mm')}">2023-01-01 10:00</td>
                                <td><span class="badge bg-success">创建账号</span></td>
                                <td>账号创建成功</td>
                            </tr>
                            <tr th:if="${teacher.updateTime}">
                                <td th:text="${#temporals.format(teacher.updateTime, 'yyyy-MM-dd HH:mm')}">2023-01-02 14:30</td>
                                <td><span class="badge bg-warning">信息更新</span></td>
                                <td>基本信息更新</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // 表单验证
    $('#teacherEditForm').submit(function(e) {
        e.preventDefault();

        // 验证必填项
        let isValid = true;
        $('input[required], select[required]').each(function() {
            if (!$(this).val()) {
                $(this).addClass('is-invalid');
                isValid = false;
            } else {
                $(this).removeClass('is-invalid');
            }
        });

        // 验证工号格式
        const teacherId = $('#teacherId').val();
        if (teacherId && !/^[A-Za-z0-9]+$/.test(teacherId)) {
            $('#teacherId').addClass('is-invalid');
            $('#teacherId').next('.form-text').addClass('text-danger');
            $('#teacherId').next('.form-text').text('工号只能包含字母和数字');
            isValid = false;
        }

        // 验证用户名格式
        const username = $('#username').val();
        if (username && !/^[a-zA-Z0-9_]+$/.test(username)) {
            $('#username').addClass('is-invalid');
            $('#username').next('.form-text').addClass('text-danger');
            $('#username').next('.form-text').text('用户名只能包含字母、数字和下划线');
            isValid = false;
        }

        if (isValid) {
            // 显示加载状态
            const submitBtn = $('#submitBtn');
            const originalText = submitBtn.html();
            submitBtn.prop('disabled', true);
            submitBtn.html('<i class="fas fa-spinner fa-spin"></i> 保存中...');

            // 提交表单
            setTimeout(() => {
                this.submit();
            }, 500);
        } else {
            // 滚动到第一个错误位置
            $('html, body').animate({
                scrollTop: $('.is-invalid').first().offset().top - 100
            }, 500);
        }
    });

    // 输入框实时验证
    $('input, select').on('input change', function() {
        if ($(this).hasClass('is-invalid')) {
            $(this).removeClass('is-invalid');
            if ($(this).attr('id') === 'teacherId') {
                $(this).next('.form-text').removeClass('text-danger');
                $(this).next('.form-text').text('工号将作为教师的唯一标识，不可重复');
            }
            if ($(this).attr('id') === 'username') {
                $(this).next('.form-text').removeClass('text-danger');
                $(this).next('.form-text').text('用户名用于登录系统，不可重复');
            }
        }
    });

    // 返回列表
    function goBack() {
        if ($('#teacherEditForm')[0].checkValidity()) {
            if (confirm('确定要取消吗？已修改的内容将不会被保存。')) {
                window.location.href = 'admin/teachers';
            }
        } else {
            window.location.href = 'admin/teachers';
        }
    }

    // 页面加载时自动聚焦到第一个输入框
    $(document).ready(function() {
        $('#teacherId').focus();

        // 自动关闭警告框
        setTimeout(function() {
            $('.alert').alert('close');
        }, 5000);

        // 阻止浏览器后退按钮
        if (window.history && window.history.pushState) {
            window.history.pushState(null, null, window.location.href);
            window.onpopstate = function() {
                window.history.pushState(null, null, window.location.href);
            };
        }
    });
</script>
</body>
</html>